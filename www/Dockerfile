FROM node:14
ARG DEPLOYMENT
ENV DEPLOYMENT ${DEPLOYMENT:-local}
ARG OG_META
ENV OG_META ${OG_META:-http://localhost:3000}
ARG GOOGLE_APPLICATION_CREDENTIALS
ENV GOOGLE_APPLICATION_CREDENTIALS ${GOOGLE_APPLICATION_CREDENTIALS}

WORKDIR /app
COPY package.json yarn.lock ./
RUN yarn
COPY . ./
RUN echo -n ${GOOGLE_APPLICATION_CREDENTIALS}
RUN echo -n ${GOOGLE_APPLICATION_CREDENTIALS} | base64 --decode > key.json && GOOGLE_APPLICATION_CREDENTIALS=key.json yarn build && rm key.json
ENV PORT=80
EXPOSE 80
CMD yarn start
