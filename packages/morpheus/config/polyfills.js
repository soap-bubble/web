/* eslint-disable import/no-extraneous-dependencies, global-require */
/* global window, document */
import { jsdom } from 'jsdom';
import 'rxjs';
import 'babel-polyfill';

if (typeof Promise === 'undefined') {
  // Rejection tracking prevents a common issue where React gets into an
  // inconsistent state due to an error, but it gets swallowed by a Promise,
  // and the user has no idea what causes React's erratic future behavior.
  require('promise/lib/rejection-tracking').enable();
  window.Promise = require('promise/lib/es6-extensions.js');
}

// fetch() polyfill for making API calls.
require('whatwg-fetch');

// Object.assign() is commonly used with React.
// It will use the native implementation if it's present and isn't buggy.
Object.assign = require('object-assign');

global.document = jsdom('');
global.window = document.defaultView;
global.location = {
  search: '',
};
global.navigator = {
  userAgent: 'node.js',
};

function copyProps(src, target) {
  const props = Object.getOwnPropertyNames(src)
    .filter(prop => typeof target[prop] === 'undefined')
    .map(prop => Object.getOwnPropertyDescriptor(src, prop));
  Object.defineProperties(target, props);
}
copyProps(document.defaultView, global);

global.HTMLCanvasElement = global.HTMLDivElement;
global.config = {
  assetHost: 'http://assetHost',
  apiHost: 'http://apiHost',
  authHost: 'http://authHost',
};
